<!DOCTYPE html>
<html lang="zh">
<head>
    <title>注册</title>
    [#include "meta.html"/]
    [#include "css.html"/]
    <style>
        table td {
            height: 45px;
            font-size: 20px;
            text-align: right;
            position: relative;
        }

        input {
            height: 30px;
            font-size: 20px;
        }

        input[type='button'] {
            display: block;
            width: 120px;
            height: 35px;
            cursor: pointer;
        }
        label.error{
            display: inline;
            color: red;
            position: absolute;
            width: 200px;
            text-align: left;
            left: 270px;
            top: 10px;
        }
    </style>
    [#include "js.html"/]
</head>

<body>
[#include "header/header.html"/]

<div style="width: 940px;    margin-top: 60px;margin-bottom: 60px;">
    <form id="gy-register-form">
        <div>
            <table style="width: 360px;">
                <tbody>
                <tr>
                    <td><label>*用户名：</label></td>
                    <td><input type="text" name="loginId" id="loginId"/></td>
                </tr>
                <tr>
                    <td><label>*手机号：</label></td>
                    <td><input type="text" name="phoneNumber" id="phoneNumber"/></td>
                </tr>

                <tr>
                    <td><label>*邮箱：</label></td>
                    <td><input type="text" name="email" id="email"/></td>
                </tr>
                <tr>
                    <td><label>*密码：</label><br/></td>
                    <td><input type="password" name="password" id="password"/></td>
                </tr>

                <tr>
                    <td><label>*密码确认：</label><br/></td>
                    <td><input type="password" name="confirmPassword" id="confirmPassword"/></td>
                </tr>
                <tr>
                    <td><label><img src="${path!}/management/verifycode.backend?9" class="code"/></label><br/></td>
                    <td><input type="text" name="code" id="code"/></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="checkbox" name="terms" style="    height: 16px;"/> <span style="color: gray;">我已经阅读</span><a href="#">《EEPAU服务协议》</a></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="button" value="登录" id="login-btn" name="loginBtn"/></td>
                </tr>
                </tbody>
            </table>
        </div>
        <input type="hidden" name="firstname" value="null"/>
        <input type="hidden" name="lastname" value="null"/>
    </form>
</div>
[#include "footer/footer.html"/]
<script src="${res!}/resources/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="${res!}/resources/plugins/jquery-validation/additional-methods.min.js"></script>
<script type="text/javascript">
    $(function () {

        $("#gy-register-form").validate({
            debug: true, //调试模式取消submit的默认提交功能
            //errorClass: "label.error", //默认为错误的样式类为：error
            focusInvalid: false, //当为false时，验证无效时，没有焦点响应
            onkeyup: true,
            rules:{
                loginId:{
                    required:true,
                    rangelength:[1,20]
                },
                phoneNumber:{
                    required:true,
                    mobileCN:true
                },
                email:{
                    required:true,
                    email:true
                },
                password:{
                    required:true,
                    rangelength:[1,20]
                },
                confirmPassword:{
                    required:true,
                    equalTo:"#password"
                },
                code:{
                    required:true,
                    remote:{
                        url: "${path!}/management/verifycode/valid.backend",     //后台处理程序
                        type: "GET",               //数据发送方式
                        dataType: "json",           //接受数据格式
                        data: {                     //要传递的数据
                            verifyCode: function () {
                                return $("#code").val();
                            }
                        }
                    }
                }
            },
            messages:{
                loginId:{
                    required:"用户名必须填写。",
                    rangelength:"用户名长度必须为{0}到{1}。"
                },
                phoneNumber:{
                    required:"手机号必须填写。",
                    mobileCN:"手机号格式不正确。"
                },
                email:{
                    required:"邮箱必须填写。",
                    email:"邮箱格式不正确。"
                },
                password:{
                    required:"密码必须填写。",
                    rangelength:"密码长度必须为{0}到{1}。"
                },
                confirmPassword:{
                    required:"确认密码必须填写。",
                    equalTo:"与密码不一致。"
                },
                code:{
                    remote:"验证码不正确。",
                    required:"验证码必须填写"
                }
            },
            submitHandler:function(form){
                var uri = "${path!}/frontend/register"
                var params = $(form).serialize();

                uri += "?" + params
                $.post(uri,null, function (result) {

                    try {
                        var jsonData = JSON.parse(result);
                        if(jsonData.code == "-1000")
                            alert("注册失败，请稍后再试!");
                    } catch (e) {
                        alert("注册成功!")
                        location.href = "${path!}/login";
                    }

                });
            }
        });


        $(".code").click(function(){
            $(this).attr("src","${path!}/management/verifycode.backend?a=" + new Date());
        });


        $("#login-btn").click(function(){
            $("#gy-register-form").submit();
        })
    })


</script>

</body>
</html>
